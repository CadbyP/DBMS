CREATE DATABASE LIBRARY; 

USE LIBRARY; 

CREATE TABLE BORROWER(ROLLNO INT(10),NAME VARCHAR(11),DATEOFISSUE DATE,NAMEOFBOOK VARCHAR(10),STATUS CHAR(10)); 

DESC BORROWER; 

INSERT INTO BORROWER(ROLLNO,NAME,DATEOFISSUE,NAMEOFBOOK,STATUS)VALUES('101','RAM','2017-06-17','DBMS','R'),('102','SHAM','2017-07-20','ISEE','I'), ('103','SITA','2017-07-15','SE','R'),('104','MITA','2017-08-26','TOC','I'); 

SELECT *FROM BORROWER; 

CREATE TABLE LIBRARY_AUDIT(ROLLNO INT(10) PRIMARY KEY,NAME VARCHAR(10),DATEOFISSUE DATE,NAMEOFBOOK VARCHAR(10),STATUS CHAR(2),TS TIMESTAMP); 

DESC LIBRARY_AUDIT; 

DELIMITER // 
CREATE TRIGGER AFTER_TRIGGER AFTER INSERT ON BORROWER FOR EACH ROW 
BEGIN 
INSERT INTO LIBRARY_AUDIT VALUES(NEW.ROLLNO,NEW.NAME,NEW.DATEOFISSUE,NEW.NAMEOFBOOK,NEW.STATUS,CURRENT_TIMESTAMP); 
END; // 

SELECT *FROM LIBRARY_AUDIT;  // 

INSERT INTO BORROWER VALUES('106','GITA','2017-08-27','DBMS','I'); // 

SELECT *FROM BORROWER; // 

SELECT *FROM LIBRARY_AUDIT; // 

CREATE TRIGGER AFTER_DELETE AFTER DELETE ON BORROWER FOR EACH ROW 
BEGIN 
INSERT INTO LIBRARY_AUDIT VALUES(OLD.ROLLNO,OLD.NAME,OLD.DATEOFISSUE,OLD.NAMEOFBOOK,OLD.STATUS,CURRENT_TIMESTAMP); 
END; // 

DELETE FROM BORROWER WHERE ROLLNO=104; // 

SELECT *FROM LIBRARY_AUDIT; // 

CREATE TRIGGER AFTER_UPDATE AFTER UPDATE ON BORROWER FOR EACH ROW 
BEGIN 
INSERT INTO LIBRARY_AUDIT VALUES(NEW.ROLLNO,NEW.NAME,NEW.DATEOFISSUE,NEW.NAMEOFBOOK,NEW.STATUS,CURRENT_TIMESTAMP); 
END; // 

UPDATE BORROWER SET STATUS='R' WHERE BORROWER.ROLLNO='102'; // 

SELECT *FROM LIBRARY_AUDIT; // 

DELIMITER // 
CREATE TRIGGER BEFORE_INSERT BEFORE INSERT ON BORROWER FOR EACH ROW 
BEGIN 
INSERT INTO LIBRARY_AUDIT VALUES(NEW.ROLLNO,NEW.NAME,NEW.DATEOFISSUE,NEW.NAMEOFBOOK,NEW.STATUS,CURRENT_TIMESTAMP); 
END; // 

INSERT INTO BORROWER VALUES('107','DEV','2017--09-17','TOC','R'); // 

SELECT *FROM BORROWER; // 

SELECT *FROM LIBRARY_AUDIT; // 

CREATE TRIGGER BEFORE_DELETE BEFORE DELETE ON BORROWER FOR EACH ROW 
BEGIN 
INSERT INTO LIBRARY_AUDIT VALUES(OLD.ROLLNO,OLD.NAME,OLD.DATEOFISSUE,OLD.NAMEOFBOOK,OLD.STATUS,CURRENT_TIMESTAMP); 
END; // 

DELETE FROM BORROWER WHERE ROLLNO=103; // 

SELECT *FROM BORROWER; // 

SELECT *FROM LIBRARY_AUDIT; // 

CREATE TRIGGER BEFORE_UPDATE BEFORE UPDATE ON BORROWER FOR EACH ROW 
BEGIN 
INSERT INTO LIBRARY_AUDIT VALUES(NEW.ROLLNO,NEW.NAME,NEW.DATEOFISSUE,NEW.NAMEOFBOOK,NEW.STATUS,CURRENT_TIMESTAMP); 
END; //  

UPDATE BORROWER SET STATUS='R' WHERE BORROWER.ROLLNO='106'; // 

SELECT *FROM BORROWER; // 
 
SELECT *FROM LIBRARY_AUDIT; // 
